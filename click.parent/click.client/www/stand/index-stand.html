<!DOCTYPE html>
<html lang="en" id="htmlId"
      onselectstart="return false" onpaste="return false;" onCopy="return false" onCut="return false"
      onDrag="return false" onDrop="return false" autocomplete=off>
<head>
  <meta charset="UTF-8">
  <meta name="viewport"
        content="width=device-width, target-densitydpi=device-dpi, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

  <!-- CSS -->
  <link href="css/MainPage.css" rel="stylesheet">

  <!-- JS COMMON -->
  <!-- @include(cordova.htmlinc) -->
  <script src="lib/js/riot.js"></script>
  <script src="lib/js/all.js"></script>

  <script src="js/encryption/sha512.js"></script>
  <script src="js/encryption/md5.js"></script>
  <script src="js/api/WebApi.js"></script>
  <script src="js/globalObjects/global.Objects.js"></script>

  <!-- FAKES -->
  <script src="stand/fakedSocket.js"></script>
  <script src="stand/allMethods.js"></script>

  <script src="stand/plugins/sms_fake.js"></script>
  <script src="stand/plugins/plugins_fake.js"></script>


</head>

<body id="bodyId">

<div id="riotTags">
  <view-main-page></view-main-page>
</div>

<script>
  api.init();
  scope = this;
  var startApplication = function () {

    if (localStorage.getItem('click_client_token') && JSON.parse(localStorage.getItem('confirm_needed')) !== true) {
      this.riotTags.innerHTML = "<view-authorization>";
      riot.mount('view-authorization')
    }
    else {
      this.riotTags.innerHTML = "<view-registration-device>";
      riot.mount('view-registration-device');
    }
    riot.mount('view-main-page');
  };

  if (window.cordova) {
    document.addEventListener("deviceready", function () {

      document.addEventListener("backbutton", onBackKeyDown, false);
      startApplication();
    }, false);
  } else {
    startApplication();
  }

  if (JSON.parse(localStorage.getItem('demo_version')) === true) {
    this.closeDemo();
  }
  function onBackKeyDown() {
    historyOfApp();
  }

  historyOfApp = function () {
    console.log(this.riotTags);
    history.arrayOfHistory = JSON.parse(sessionStorage.getItem('history'));

    if (history.arrayOfHistory.length != 0) {
      history.arrayOfHistory.pop();
      if (history.arrayOfHistory.length != 0) {
        console.log('THIS IS riotTags div ', this.riotTags)
        console.log("JSON ", JSON.stringify(history.arrayOfHistory));
        console.log('LAST ELEMENT ', history.arrayOfHistory[history.arrayOfHistory.length - 1]);
        console.log('LAST ELEMENT in RIOT TAG ', "<" + history.arrayOfHistory[history.arrayOfHistory.length - 1] + ">");
        this.riotTags.innerHTML = "<" + history.arrayOfHistory[history.arrayOfHistory.length - 1] + ">";
        riot.mount(history.arrayOfHistory[history.arrayOfHistory.length - 1]);
      }
    }
  }


  //MENU FUNCTIONS FOR ALL PAGES
  //  var touchStartX, touchEndX;
  //  touchStart = function () {
  //    event.preventDefault();
  //    event.stopPropagation();
  //    touchStartX = event.changedTouches[0].pageX;
  //  }
  //
  //  touchEnd = function () {
  //    event.preventDefault();
  //    event.stopPropagation();
  //    touchEndX = event.changedTouches[0].pageX;
  //    if (touchStartX < touchEndX && touchStartX <= 15) {
  //      this.menuOpen();
  //    }
  //  }

</script>
</body>
</html>
